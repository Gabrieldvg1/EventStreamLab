bundle:
  name: eventstreamlab

targets:
  default:
    mode: development
    default: true

    workspace:
      host: {}

    resources:
      pipelines:
        events_pipeline:
          name: "eventstreamlab_events_pipeline"

          # Using hive_metastore.default
          target: "default"

          libraries:
            - file:
                path: ./dlt/kafka_ingestion.py

          clusters:
            - label: default
              node_type_id: "Standard_D4s_v3"
              autoscale:
                min_workers: 1
                max_workers: 1

          configuration:
            # Kafka / Event Hubs
            BOOTSTRAP_SERVER: "eventstreamlab-ns.servicebus.windows.net:9093"

            # Secrets
            EVENT_HUB_SECRET_SCOPE: "event-hubs"
            EVENT_HUB_SECRET_KEY: "connection-string"

            # NEW: config-driven ingestion
            FLOWS: >
              [
                {
                  "topic_name": "demo-events",
                  "table_name": "events_raw"
                }
              ]

      jobs:
        run_events_pipeline:
          name: "Run EventStreamLab DLT pipeline"
          tasks:
            - task_key: run-events-pipeline
              pipeline_task:
                pipeline_id: ${resources.pipelines.events_pipeline.id}
